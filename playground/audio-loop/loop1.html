<html>
  <head>
    <title>loop</title>
    <script>
      var SAMPLES = [
        { id: 'beats', src: 'beats.wav' , name: 'Beats'},
        { id: '100hz', src: '100Hz_44100Hz_16bit_05sec.wav', name: '100Hz Sine'},
        { id: '250hz', src: '250Hz_44100Hz_16bit_05sec.wav', name: '250Hz Sine' },
        { id: '440hz', src: '440Hz_44100Hz_16bit_05sec.wav', name: '440Hz Sine' },
        { id: '1khz', src: '1kHz_44100Hz_16bit_05sec.wav', name: '1kHz Sine' },
        { id: '10khz', src: '10kHz_44100Hz_16bit_05sec.wav', name: '10kHz Sine' }
      ];

      var EVENTS = [ 'seeking', 'seeked' ];

      function GetAudio() {
        return document.getElementById('playback');
      }

      function GetOptions() {
        return document.getElementById('options');
      }

      function GetLog() {
        return document.getElementById('logger');
      }

      function GetLoopButton() {
        return document.getElementById('loop');
      }

      function GetRate() {
        return document.getElementById('rate');
      }

      function GetPlaybackRate() {
        return Number(GetRate().value);
      }

      function SetSource(aSrc) {
        let element = GetAudio();
        element.src = aSrc;
      }

      function Pause() {
        let element = GetAudio();
        element.pause();
      }

      function Play() {
        let element = GetAudio();
        element.play();
      }

      function IsPlaying() {
        let element = GetAudio();
        return !element.paused;
      }

      function SwitchSourceAndPlay(aSrc) {
        if (IsPlaying()) {
          Pause();
        }
        SetSource(aSrc);
        Play();
      }

      function ShowLoop() {
        let audioElement = GetAudio();
        let loopButton = GetLoopButton();
        loopButton.style.background = audioElement.loop ? 'red' : 'black';
      }

      function ToggleLoop() {
        let audioElement = GetAudio();
        let loopButton = GetLoopButton();
        audioElement.loop = !audioElement.loop;
        ShowLoop();
      }

      function ShowDefaultRate() {
        let element = GetAudio();
        GetRate().value = element.playbackRate;
      }

      function SetPlaybackRate() {
        let element = GetAudio();
        element.playbackRate = GetPlaybackRate();
      }

      function CountEvent(event) {
        let count = document.getElementById(event.type);
        count.innerText = Number(count.innerText) + 1;
      }

      function SetEventListeners() {
        for (let i = 0 ; i < EVENTS.length ; ++i) {
          GetAudio().addEventListener(EVENTS[i], CountEvent, false);
        }
      }

      function LoadSamples() {
        for (let i = 0 ; i < SAMPLES.length ; ++i) {
          let btn = document.createElement('button');
          btn.id = SAMPLES[i].id;
          btn.innerText = SAMPLES[i].name;
          btn.addEventListener('click', function(e) {
            SwitchSourceAndPlay(SAMPLES[i].src);
          });
          GetOptions().appendChild(btn);
        }

        for (let i = 0 ; i < EVENTS.length ; ++i) {
          let type = document.createTextNode(EVENTS[i] + ': ');
          GetLog().appendChild(type);
          let count = document.createElement('p');
          count.innerText = '0';
          count.id = EVENTS[i];
          count.style.display = 'inline';
          GetLog().appendChild(count);
          let br = document.createElement('br');
          GetLog().appendChild(br);
        }
      }

      document.addEventListener("DOMContentLoaded", function() {
        LoadSamples();
        SetEventListeners();
        ShowLoop();
        ShowDefaultRate();
      });
    </script>
  </head>
  <body>
    <h1>Is playback seamless-looping yet?</h1>
    <div id='options'></div>
    <div id='controlpanel'>
      <button id='loop' style='color:white' onclick='ToggleLoop()'>Loop</button>
      rate: <input id='rate' type='text'><button id='setRate' onclick='SetPlaybackRate()'>set</button>
    </div>
    <div id='logger'>
    </div>
    <br />
    <audio id='playback' loop controls></audio>
  </body>
</html>
