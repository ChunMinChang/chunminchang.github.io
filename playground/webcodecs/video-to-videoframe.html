<html>
  <head>
    <title>VideoElement to VideoFrame</title>
    <script src="webrtc.js"></script>
    <script>
      async function runTest() {
        const { video, stream } = await createStreamingVideo();
        const stmSettings = stream.getVideoTracks()[0].getSettings();
        console.log(
          "stream size: " + stmSettings.width + "x" + stmSettings.height
        );
        console.log(
          "video size: " + video.videoWidth + "x" + video.videoHeight
        );
        const container = document.getElementById("camera");
        container.appendChild(video);

        const cvs = document.createElement("canvas");
        container.appendChild(cvs);

        button.replaceWith(button.cloneNode(false));
        button.disabled = false;
        button.textContent = "Take Picture";
        button.addEventListener("click", async () => {
          const vf = takePicture(video);
          console.log("videoframe size: ", vf.displayWidth, vf.displayHeight);
          drawVideoToCanvas(vf, cvs);
        });
      }

      function drawVideoToCanvas(vf, canvas) {
        const ctx = canvas.getContext("2d");
        canvas.width = vf.displayWidth;
        canvas.height = vf.displayHeight;
        ctx.drawImage(vf, 0, 0, canvas.width, canvas.height);
      }

      window.addEventListener("DOMContentLoaded", (event) => {
        const button = document.getElementById("button");
        button.addEventListener("click", (event) => {
          event.target.disabled = true;
          runTest();
        });
      });
    </script>
  </head>
  <body>
    <h1>VideoElement to VideoFrame</h1>
    <button id="button">Start</button>
    <div id="camera"></div>
  </body>
</html>
