<html>
  <head>
    <title>VideoElement to VideoFrame</title>
    <script src="webrtc.js"></script>
    <script>
      var videoElement = null;
      var startbutton = null;
      var takephoto = null;
      var canvasElement = null;

      async function startVideo() {
        const stream = await getVideoStream();
        console.log(stream.getVideoTracks()[0].getSettings());
        video.srcObject = stream;
        video.play();
      }

      function drawVideoToCanvas(video, canvas) {
        console.log("video size: ", video.videoWidth, video.videoHeight);
        const vf = takePicture(video);
        console.log("videoframe size: ", vf.displayWidth, vf.displayHeight);
        const ctx = canvas.getContext("2d");
        canvas.width = vf.displayWidth;
        canvas.height = vf.displayHeight;
        ctx.drawImage(vf, 0, 0, canvas.width, canvas.height);
      }

      window.addEventListener("DOMContentLoaded", (event) => {
        canvasElement = document.getElementById("canvas");
        takephoto = document.getElementById("takephoto");

        videoElement = document.getElementById("video");
        videoElement.addEventListener("canplay", (event) => {
          takephoto.disabled = false;
          takephoto.addEventListener("click", (event) => {
            takephoto.disabled = true;
            drawVideoToCanvas(videoElement, canvasElement);
          });
        });

        startbutton = document.getElementById("startbutton");
        startbutton.addEventListener("click", (event) => {
          event.target.disabled = true;
          startVideo();
        });
      });
    </script>
  </head>
  <body>
    <h1>VideoElement to VideoFrame</h1>
    <button id="startbutton">Start</button>
    <button id="takephoto" disabled>Take photo</button>
    <div class="camera">
      <video id="video">Video stream not available.</video>
      <canvas id="canvas"></canvas>
    </div>
  </body>
</html>
